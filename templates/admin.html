<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Cosmic Astrology</title>
    <script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="/static/styles/main.css">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.15.4/css/all.css">
</head>
<body class="bg-gray-100">

    <!-- ========== LOGIN SCREEN ========== -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center px-4 bg-gradient-to-br from-purple-600 to-pink-600">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-96">
            <div class="text-center mb-6">
                <i class="fas fa-moon text-6xl text-purple-600 mb-4"></i>
                <h1 class="text-3xl font-bold text-gray-800">Admin Login</h1>
                <p class="text-gray-600 mt-2">Cosmic Astrology Dashboard</p>
            </div>
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="admin-password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="admin-password" autocomplete="current-password" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" placeholder="Enter admin password" required>
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 px-4 rounded-lg font-semibold hover:shadow-lg transform hover:-translate-y-0.5 transition">
                    <i class="fas fa-sign-in-alt mr-2"></i>Login
                </button>
                <p id="login-error" class="text-red-500 text-sm text-center hidden">Incorrect password!</p>
            </form>
        </div>
    </div>

    <!-- ========== ADMIN DASHBOARD ========== -->
    <div id="admin-dashboard" class="hidden">
        <!-- Navbar -->
        <nav class="bg-gradient-to-r from-purple-700 to-pink-600 text-white shadow-lg sticky top-0 z-50">
            <div class="container mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <h1 class="text-2xl font-bold">Admin Dashboard</h1>
                    <button onclick="logout()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-6 py-2 rounded-lg transition font-semibold">
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </button>
                </div>
            </div>
        </nav>

        <div class="container mx-auto px-6 py-8">
            <!-- Tab Navigation -->
            <div class="bg-white rounded-2xl shadow-lg p-2 mb-6">
                <div class="flex flex-wrap gap-2">
                    <button class="tab-btn active px-6 py-3 rounded-xl font-semibold text-sm" data-tab="stats">
                        <i class="fas fa-chart-bar mr-2"></i>Stats
                    </button>
                    <button class="tab-btn px-6 py-3 rounded-xl font-semibold text-sm text-gray-600 hover:bg-gray-100" data-tab="hero">
                        <i class="fas fa-images mr-2"></i>Hero Slides
                    </button>
                    <button class="tab-btn px-6 py-3 rounded-xl font-semibold text-sm text-gray-600 hover:bg-gray-100" data-tab="gallery">
                        <i class="fas fa-photo-video mr-2"></i>Gallery
                    </button>
                    <button class="tab-btn px-6 py-3 rounded-xl font-semibold text-sm text-gray-600 hover:bg-gray-100" data-tab="messages">
                        <i class="fas fa-envelope mr-2"></i>Messages
                    </button>
                    <button class="tab-btn px-6 py-3 rounded-xl font-semibold text-sm text-gray-600 hover:bg-gray-100" data-tab="bookings">
                        <i class="fas fa-calendar-check mr-2"></i>Bookings
                    </button>
                    <button class="tab-btn px-6 py-3 rounded-xl font-semibold text-sm text-gray-600 hover:bg-gray-100" data-tab="business">
                        <i class="fas fa-building mr-2"></i>Business Info
                    </button>
                    <button class="tab-btn px-6 py-3 rounded-xl font-semibold text-sm text-gray-600 hover:bg-gray-100" data-tab="chatbot">
                        <i class="fas fa-robot mr-2"></i>Chatbot Config
                    </button>
                    <button class="tab-btn px-6 py-3 rounded-xl font-semibold text-sm text-gray-600 hover:bg-gray-100" data-tab="about">
                        <i class="fas fa-user-tie mr-2"></i>About Section
                    </button>
                    <button class="tab-btn px-6 py-3 rounded-xl font-semibold text-sm text-gray-600 hover:bg-gray-100" data-tab="settings">
                        <i class="fas fa-cog mr-2"></i>Settings
                    </button>
                </div>
            </div>

            <!-- Tab Content -->
            <div id="stats-section" class="tab-content">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- Hero Slides Card -->
                    <div class="card bg-white rounded-2xl p-6 shadow-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-14 h-14 gradient-purple rounded-xl flex items-center justify-center">
                                <i class="fas fa-images text-white text-2xl"></i>
                            </div>
                            <span class="text-xs font-semibold text-purple-600 bg-purple-50 px-3 py-1 rounded-full">ACTIVE</span>
                        </div>
                        <p class="text-gray-500 text-sm font-medium mb-1">Hero Slides</p>
                        <p class="stat-number text-purple-600" id="stat-hero">0</p>
                    </div>
                    <!-- Gallery Card -->
                    <div class="card bg-white rounded-2xl p-6 shadow-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-14 h-14 gradient-blue rounded-xl flex items-center justify-center">
                                <i class="fas fa-photo-video text-white text-2xl"></i>
                            </div>
                            <span class="text-xs font-semibold text-blue-600 bg-blue-50 px-3 py-1 rounded-full">MEDIA</span>
                        </div>
                        <p class="text-gray-500 text-sm font-medium mb-1">Gallery Items</p>
                        <p class="stat-number text-blue-600" id="stat-gallery">0</p>
                    </div>
                    <!-- Contacts Card -->
                    <div class="card bg-white rounded-2xl p-6 shadow-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-14 h-14 gradient-green rounded-xl flex items-center justify-center">
                                <i class="fas fa-envelope text-white text-2xl"></i>
                            </div>
                            <span class="text-xs font-semibold text-green-600 bg-green-50 px-3 py-1 rounded-full">INBOX</span>
                        </div>
                        <p class="text-gray-500 text-sm font-medium mb-1">Messages</p>
                        <p class="stat-number text-green-600" id="stat-messages">0</p>
                    </div>
                    <!-- Bookings Card -->
                    <div class="card bg-white rounded-2xl p-6 shadow-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-14 h-14 gradient-orange rounded-xl flex items-center justify-center">
                                <i class="fas fa-calendar-check text-white text-2xl"></i>
                            </div>
                            <span class="text-xs font-semibold text-orange-600 bg-orange-50 px-3 py-1 rounded-full">PENDING</span>
                        </div>
                        <p class="text-gray-500 text-sm font-medium mb-1">Bookings</p>
                        <p class="stat-number text-orange-600" id="stat-bookings">0</p>
                    </div>
                </div>
            </div>

            <div id="hero-section" class="tab-content hidden">
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-images text-purple-600 mr-2"></i>Hero Slides Management
                        </h2>
                        <button id="add-hero-slide-btn" class="admin-btn admin-btn-primary">
                            <i class="fas fa-plus mr-2"></i>Add New Slide
                        </button>
                    </div>
                    
                    <div id="hero-slide-form-container" class="hidden admin-form">
                        <h3 class="text-lg font-bold mb-4">
                            <i class="fas fa-edit text-purple-600 mr-2"></i>Slide Details
                        </h3>
                        <form id="hero-slide-form" class="space-y-4">
                            <input type="hidden" id="hero-slide-id">
                            <div class="form-group">
                                <label for="hero-slide-title" class="form-label">
                                    <i class="fas fa-heading text-gray-500 mr-2"></i>Slide Title
                                </label>
                                <input type="text" id="hero-slide-title" class="admin-input" placeholder="Enter slide title..." required>
                            </div>
                            <div class="form-group">
                                <label for="hero-slide-description" class="form-label">
                                    <i class="fas fa-align-left text-gray-500 mr-2"></i>Description
                                </label>
                                <textarea id="hero-slide-description" rows="3" class="admin-input" placeholder="Enter slide description..." required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="hero-slide-image" class="form-label">
                                    <i class="fas fa-image text-gray-500 mr-2"></i>Slide Image
                                </label>
                                <input type="file" id="hero-slide-image" accept="image/*" class="admin-input">
                                <p class="text-sm text-gray-500 mt-1">Upload image (recommended: 1920x1080px)</p>
                            </div>
                            <div class="flex gap-4">
                                <button type="submit" class="admin-btn admin-btn-success">
                                    <i class="fas fa-save mr-2"></i>Save Slide
                                </button>
                                <button type="button" id="cancel-hero-slide-edit" class="admin-btn admin-btn-secondary">
                                    <i class="fas fa-times mr-2"></i>Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                    <div id="hero-slides-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Hero slides will be loaded here -->
                    </div>
                </div>
            </div>
            <div id="gallery-section" class="tab-content hidden">
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-photo-video text-blue-600 mr-2"></i>Gallery Management
                        </h2>
                        <button id="add-gallery-image-btn" class="admin-btn admin-btn-primary">
                            <i class="fas fa-plus mr-2"></i>Add New Image
                        </button>
                    </div>
                    
                    <div id="gallery-image-form-container" class="hidden admin-form">
                        <h3 class="text-lg font-bold mb-4">
                            <i class="fas fa-image text-blue-600 mr-2"></i>Image Details
                        </h3>
                        <form id="gallery-image-form" class="space-y-4">
                            <input type="hidden" id="gallery-image-id">
                            <div class="form-group">
                                <label for="gallery-image-title" class="form-label">
                                    <i class="fas fa-tag text-gray-500 mr-2"></i>Image Title
                                </label>
                                <input type="text" id="gallery-image-title" class="admin-input" placeholder="Enter image title..." required>
                            </div>
                            <div class="form-group">
                                <label for="gallery-image-description" class="form-label">
                                    <i class="fas fa-align-left text-gray-500 mr-2"></i>Description
                                </label>
                                <textarea id="gallery-image-description" class="admin-input" rows="3" placeholder="Enter image description..." required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="gallery-image-file" class="form-label">
                                    <i class="fas fa-upload text-gray-500 mr-2"></i>Image File
                                </label>
                                <input type="file" id="gallery-image-file" accept="image/*" class="admin-input">
                                <p class="text-sm text-gray-500 mt-1">Supported formats: JPG, PNG, WebP</p>
                            </div>
                            <div class="flex gap-4">
                                <button type="submit" class="admin-btn admin-btn-success">
                                    <i class="fas fa-save mr-2"></i>Save Image
                                </button>
                                <button type="button" id="cancel-gallery-image-edit" class="admin-btn admin-btn-secondary">
                                    <i class="fas fa-times mr-2"></i>Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                    <div id="gallery-images-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Gallery images will be loaded here -->
                    </div>
                </div>
            </div>
            <div id="messages-section" class="tab-content hidden">
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-envelope text-green-600 mr-2"></i>Contact Messages
                        </h2>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm text-gray-500">Total Messages:</span>
                            <span class="font-bold text-green-600" id="total-messages">0</span>
                        </div>
                    </div>
                    <div id="messages-list" class="space-y-4">
                        <!-- Messages will be loaded here -->
                    </div>
                </div>
            </div>
            <div id="bookings-section" class="tab-content hidden">
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-calendar-check text-orange-600 mr-2"></i>Booking Requests
                        </h2>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm text-gray-500">Pending Bookings:</span>
                            <span class="font-bold text-orange-600" id="total-bookings">0</span>
                        </div>
                    </div>
                    <div id="bookings-list" class="space-y-4">
                        <!-- Bookings will be loaded here -->
                    </div>
                </div>
            </div>
            <div id="business-section" class="tab-content hidden">
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">
                        <i class="fas fa-building text-indigo-600 mr-2"></i>Business Information
                    </h2>
                    <form id="business-info-form" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="form-group">
                                <label for="business-address" class="form-label">
                                    <i class="fas fa-map-marker-alt text-gray-500 mr-2"></i>Business Address
                                </label>
                                <textarea id="business-address" class="admin-input" rows="3" placeholder="Enter complete business address..." required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="business-email" class="form-label">
                                    <i class="fas fa-envelope text-gray-500 mr-2"></i>Contact Email
                                </label>
                                <input type="email" id="business-email" class="admin-input" placeholder="contact@example.com" required>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="form-group">
                                <label for="business-phone" class="form-label">
                                    <i class="fas fa-phone text-gray-500 mr-2"></i>Phone Number
                                </label>
                                <input type="tel" id="business-phone" class="admin-input" placeholder="+1 (555) 123-4567" required>
                            </div>
                            <div class="form-group">
                                <label for="business-website" class="form-label">
                                    <i class="fas fa-globe text-gray-500 mr-2"></i>Website URL
                                </label>
                                <input type="url" id="business-website" class="admin-input" placeholder="https://www.example.com">
                            </div>
                        </div>
                        
                        <!-- Business Hours Section -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="form-group">
                                <label for="business-hours-weekday" class="form-label">
                                    <i class="fas fa-clock text-gray-500 mr-2"></i>Weekday Hours (Mon-Sat)
                                </label>
                                <input type="text" id="business-hours-weekday" class="admin-input" placeholder="9:00 AM - 8:00 PM" required>
                            </div>
                            <div class="form-group">
                                <label for="business-hours-sunday" class="form-label">
                                    <i class="fas fa-calendar-day text-gray-500 mr-2"></i>Sunday Hours
                                </label>
                                <input type="text" id="business-hours-sunday" class="admin-input" placeholder="10:00 AM - 6:00 PM" required>
                            </div>
                        </div>
                        
                        <!-- Social Media Section -->
                        <div class="mt-8 pt-6 border-t border-gray-200">
                            <h3 class="text-lg font-bold mb-4 text-gray-800">
                                <i class="fas fa-share-alt text-blue-600 mr-2"></i>Social Media Links
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="form-group">
                                    <label for="facebook-url" class="form-label">
                                        <i class="fab fa-facebook text-blue-600 mr-2"></i>Facebook
                                    </label>
                                    <input type="url" id="facebook-url" class="admin-input" placeholder="https://facebook.com/yourpage">
                                </div>
                                <div class="form-group">
                                    <label for="instagram-url" class="form-label">
                                        <i class="fab fa-instagram text-pink-600 mr-2"></i>Instagram
                                    </label>
                                    <input type="url" id="instagram-url" class="admin-input" placeholder="https://instagram.com/yourpage">
                                </div>
                                <div class="form-group">
                                    <label for="youtube-url" class="form-label">
                                        <i class="fab fa-youtube text-red-600 mr-2"></i>YouTube
                                    </label>
                                    <input type="url" id="youtube-url" class="admin-input" placeholder="https://youtube.com/@yourchannel">
                                </div>
                                <div class="form-group">
                                    <label for="twitter-url" class="form-label">
                                        <i class="fab fa-twitter text-sky-500 mr-2"></i>Twitter
                                    </label>
                                    <input type="url" id="twitter-url" class="admin-input" placeholder="https://twitter.com/yourpage">
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-6">
                            <button type="button" id="edit-business-btn" class="admin-btn admin-btn-primary px-8">
                                <i class="fas fa-edit mr-2"></i>Edit Business Information
                            </button>
                            <button type="submit" id="save-business-btn" class="admin-btn admin-btn-success px-8 hidden">
                                <i class="fas fa-save mr-2"></i>Save Business Information
                            </button>
                            <button type="button" id="cancel-business-btn" class="admin-btn admin-btn-secondary px-8 hidden">
                                <i class="fas fa-times mr-2"></i>Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="chatbot-section" class="tab-content hidden">
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-robot text-purple-600 mr-2"></i>Chatbot Configuration
                        </h2>
                        <button type="button" id="edit-chatbot-btn" onclick="toggleChatbotEdit()" class="admin-btn admin-btn-secondary">
                            <i class="fas fa-edit mr-2"></i>Edit
                        </button>
                    </div>
                    
                    <form id="chatbot-config-form" class="space-y-6">
                        <!-- Google Maps URL -->
                        <div class="admin-form p-4">
                            <div class="form-group">
                                <label for="chatbot-google-maps" class="form-label">
                                    <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>Google Maps Location URL
                                </label>
                                <input type="url" id="chatbot-google-maps" class="admin-input" placeholder="https://maps.app.goo.gl/...">
                                <p class="text-sm text-gray-500 mt-1">Share link from Google Maps</p>
                            </div>
                        </div>

                        <!-- Google Review URL -->
                        <div class="admin-form p-4">
                            <div class="form-group">
                                <label for="chatbot-google-review" class="form-label">
                                    <i class="fas fa-star text-yellow-500 mr-2"></i>Google Review URL
                                </label>
                                <input type="url" id="chatbot-google-review" class="admin-input" placeholder="https://maps.app.goo.gl/...">
                                <p class="text-sm text-gray-500 mt-1">Link where customers can leave reviews</p>
                            </div>
                        </div>

                        <!-- Services List -->
                        <div class="admin-form p-4">
                            <label class="form-label">
                                <i class="fas fa-list text-blue-500 mr-2"></i>Services Offered (One per line)
                            </label>
                            <textarea id="chatbot-services" class="admin-input" rows="8" placeholder="Kundali Reading&#10;Tarot Reading&#10;Career Guidance&#10;..."></textarea>
                            <p class="text-sm text-gray-500 mt-1">Each line is one service</p>
                        </div>

                        <!-- Social Media URLs -->
                        <div class="admin-form p-4">
                            <h3 class="text-lg font-bold mb-4 text-gray-700">
                                <i class="fas fa-share-alt text-green-500 mr-2"></i>Social Media Links
                            </h3>
                            <div class="space-y-3">
                                <div class="form-group">
                                    <label for="chatbot-facebook" class="form-label">Facebook</label>
                                    <input type="url" id="chatbot-facebook" class="admin-input" placeholder="https://facebook.com/...">
                                </div>
                                <div class="form-group">
                                    <label for="chatbot-instagram" class="form-label">Instagram</label>
                                    <input type="url" id="chatbot-instagram" class="admin-input" placeholder="https://instagram.com/...">
                                </div>
                                <div class="form-group">
                                    <label for="chatbot-twitter" class="form-label">Twitter</label>
                                    <input type="url" id="chatbot-twitter" class="admin-input" placeholder="https://twitter.com/...">
                                </div>
                                <div class="form-group">
                                    <label for="chatbot-youtube" class="form-label">YouTube</label>
                                    <input type="url" id="chatbot-youtube" class="admin-input" placeholder="https://youtube.com/...">
                                </div>
                                <div class="form-group">
                                    <label for="chatbot-linkedin" class="form-label">LinkedIn</label>
                                    <input type="url" id="chatbot-linkedin" class="admin-input" placeholder="https://linkedin.com/...">
                                </div>
                            </div>
                        </div>

                        <!-- Working Hours -->
                        <div class="admin-form p-4">
                            <h3 class="text-lg font-bold mb-4 text-gray-700">
                                <i class="fas fa-clock text-orange-500 mr-2"></i>Working Hours
                            </h3>
                            <div class="space-y-3">
                                <div class="form-group">
                                    <label for="chatbot-hours-weekday" class="form-label">Weekday Hours</label>
                                    <input type="text" id="chatbot-hours-weekday" class="admin-input" placeholder="9:00 AM - 8:00 PM">
                                </div>
                                <div class="form-group">
                                    <label for="chatbot-hours-sunday" class="form-label">Sunday Hours</label>
                                    <input type="text" id="chatbot-hours-sunday" class="admin-input" placeholder="9:00 AM - 2:00 PM">
                                </div>
                            </div>
                        </div>

                        <div id="chatbot-form-actions" class="flex gap-4" style="display: none;">
                            <button type="submit" class="admin-btn admin-btn-success flex-1">
                                <i class="fas fa-save mr-2"></i>Save Changes
                            </button>
                            <button type="button" onclick="cancelChatbotEdit()" class="admin-btn admin-btn-danger">
                                <i class="fas fa-times mr-2"></i>Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- About Section -->
            <div id="about-section" class="tab-content hidden">
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-800">
                            <i class="fas fa-user-tie text-purple-600 mr-2"></i>About Section Configuration
                        </h2>
                        <button id="edit-about-btn" onclick="enableAboutEdit()" class="admin-btn admin-btn-primary">
                            <i class="fas fa-edit mr-2"></i>Edit
                        </button>
                    </div>
                    <form id="about-form" class="space-y-4">
                        <div class="form-group">
                            <label for="about-title" class="form-label">
                                <i class="fas fa-heading text-gray-500 mr-2"></i>Title
                            </label>
                            <input type="text" id="about-title" class="admin-input" readonly placeholder="e.g., Meet Our Expert Astrologer">
                        </div>
                        
                        <div class="form-group">
                            <label for="about-description" class="form-label">
                                <i class="fas fa-align-left text-gray-500 mr-2"></i>Description
                            </label>
                            <textarea id="about-description" class="admin-input" rows="4" readonly placeholder="Enter a detailed description..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="about-experience" class="form-label">
                                <i class="fas fa-star text-gray-500 mr-2"></i>Experience
                            </label>
                            <input type="text" id="about-experience" class="admin-input" readonly placeholder="e.g., 15+ Years">
                        </div>
                        
                        <div class="form-group">
                            <label for="about-specialization" class="form-label">
                                <i class="fas fa-gem text-gray-500 mr-2"></i>Specialization
                            </label>
                            <input type="text" id="about-specialization" class="admin-input" readonly placeholder="e.g., Vedic Astrology, Tarot Reading">
                        </div>
                        
                        <div class="form-group">
                            <label for="about-credentials" class="form-label">
                                <i class="fas fa-certificate text-gray-500 mr-2"></i>Credentials
                            </label>
                            <input type="text" id="about-credentials" class="admin-input" readonly placeholder="e.g., Certified Astrologer">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-image text-gray-500 mr-2"></i>Astrologer Image
                            </label>
                            <div class="space-y-3">
                                <input type="file" id="about-image-file" accept="image/*" class="admin-input" disabled>
                                <input type="text" id="about-image-url" class="admin-input" readonly placeholder="Image URL will appear here">
                                <button type="button" id="about-upload-btn" onclick="uploadAboutImage()" class="admin-btn admin-btn-secondary" disabled>
                                    <i class="fas fa-upload mr-2"></i>Upload Image
                                </button>
                                <div id="about-image-preview" class="mt-4"></div>
                            </div>
                        </div>
                        
                        <div id="about-form-actions" class="flex gap-3" style="display: none;">
                            <button type="submit" class="flex-1 admin-btn admin-btn-success">
                                <i class="fas fa-save mr-2"></i>Save Changes
                            </button>
                            <button type="button" onclick="cancelAboutEdit()" class="admin-btn admin-btn-danger">
                                <i class="fas fa-times mr-2"></i>Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="settings-section" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Password Change Section -->
                    <div class="bg-white rounded-2xl shadow-lg p-6">
                        <h2 class="text-xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-lock text-red-600 mr-2"></i>Change Password
                        </h2>
                        <form id="change-password-form" class="space-y-4">
                            <div class="form-group">
                                <label for="current-password" class="form-label">
                                    <i class="fas fa-key text-gray-500 mr-2"></i>Current Password
                                </label>
                                <input type="password" id="current-password" autocomplete="current-password" class="admin-input" placeholder="Enter current password..." required>
                            </div>
                            <div class="form-group">
                                <label for="new-password" class="form-label">
                                    <i class="fas fa-lock text-gray-500 mr-2"></i>New Password
                                </label>
                                <input type="password" id="new-password" autocomplete="new-password" class="admin-input" placeholder="Enter new password..." required>
                                <p class="text-sm text-gray-500 mt-1">Password must be at least 6 characters long</p>
                            </div>
                            <div class="form-group">
                                <label for="confirm-password" class="form-label">
                                    <i class="fas fa-check-circle text-gray-500 mr-2"></i>Confirm New Password
                                </label>
                                <input type="password" id="confirm-password" autocomplete="new-password" class="admin-input" placeholder="Confirm new password..." required>
                            </div>
                            <button type="submit" class="admin-btn admin-btn-success w-full">
                                <i class="fas fa-shield-alt mr-2"></i>Update Password
                            </button>
                        </form>
                    </div>

                    <!-- System Information Section -->
                    <div class="bg-white rounded-2xl shadow-lg p-6">
                        <h2 class="text-xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-info-circle text-blue-600 mr-2"></i>System Information
                        </h2>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="font-medium text-gray-600">Admin Version</span>
                                <span class="font-bold text-gray-800">v2.1.0</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="font-medium text-gray-600">Last Login</span>
                                <span class="font-bold text-gray-800" id="last-login-time">Just now</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="font-medium text-gray-600">System Status</span>
                                <span class="font-bold text-green-600">
                                    <i class="fas fa-circle text-xs mr-1"></i>Active
                                </span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="font-medium text-gray-600">Database</span>
                                <span class="font-bold text-green-600">
                                    <i class="fas fa-database mr-1"></i>Connected
                                </span>
                            </div>
                        </div>
                        <div class="mt-6 text-center">
                            <button onclick="logout()" class="admin-btn admin-btn-danger px-8">
                                <i class="fas fa-sign-out-alt mr-2"></i>Logout Securely
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Testimonial Modal -->
    <div id="testimonial-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="bg-gradient-to-r from-yellow-500 to-orange-500 text-white p-6 rounded-t-2xl">
                <h3 class="text-2xl font-bold" id="testimonial-modal-title">
                    <i class="fas fa-star mr-2"></i>Add Testimonial
                </h3>
            </div>
            <form id="testimonial-form" class="p-6 space-y-4">
                <input type="hidden" id="testimonial-id">
                
                <div class="form-group">
                    <label for="testimonial-client-name" class="form-label">
                        <i class="fas fa-user text-gray-500 mr-2"></i>Client Name
                    </label>
                    <input type="text" id="testimonial-client-name" class="admin-input" placeholder="John Doe" required>
                </div>
                
                <div class="form-group">
                    <label for="testimonial-rating" class="form-label">
                        <i class="fas fa-star text-yellow-500 mr-2"></i>Rating (1-5)
                    </label>
                    <select id="testimonial-rating" class="admin-input" required>
                        <option value="">Select Rating</option>
                        <option value="5">⭐⭐⭐⭐⭐ (5 Stars)</option>
                        <option value="4">⭐⭐⭐⭐ (4 Stars)</option>
                        <option value="3">⭐⭐⭐ (3 Stars)</option>
                        <option value="2">⭐⭐ (2 Stars)</option>
                        <option value="1">⭐ (1 Star)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="testimonial-review" class="form-label">
                        <i class="fas fa-comment text-gray-500 mr-2"></i>Review Text
                    </label>
                    <textarea id="testimonial-review" class="admin-input" rows="4" placeholder="Enter the client's review..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="testimonial-google-url" class="form-label">
                        <i class="fab fa-google text-red-500 mr-2"></i>Google Review URL (Optional)
                    </label>
                    <input type="url" id="testimonial-google-url" class="admin-input" placeholder="https://maps.app.goo.gl/...">
                    <p class="text-sm text-gray-500 mt-1">Link to the original Google review</p>
                </div>
                
                <div class="form-group">
                    <label for="testimonial-image-url" class="form-label">
                        <i class="fas fa-image text-gray-500 mr-2"></i>Client Image URL (Optional)
                    </label>
                    <input type="url" id="testimonial-image-url" class="admin-input" placeholder="https://example.com/image.jpg">
                    <p class="text-sm text-gray-500 mt-1">Link to client's profile image</p>
                </div>
                
                <div class="flex gap-3 mt-6">
                    <button type="submit" class="flex-1 admin-btn admin-btn-success">
                        <i class="fas fa-save mr-2"></i>Save Testimonial
                    </button>
                    <button type="button" onclick="closeTestimonialModal()" class="flex-1 admin-btn admin-btn-secondary">
                        <i class="fas fa-times mr-2"></i>Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Admin Login
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const password = document.getElementById('admin-password').value;
            
            try {
                const response = await fetch('/api/admin/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('admin-dashboard').classList.remove('hidden');
                    loadDashboardData();
                    initializeBusinessForm();
                    initializeChatbotForm();
                } else {
                    document.getElementById('login-error').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Login error:', error);
                document.getElementById('login-error').classList.remove('hidden');
            }
        });

        function logout() {
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('admin-dashboard').classList.add('hidden');
            document.getElementById('admin-password').value = '';
            document.getElementById('login-error').classList.add('hidden');
        }

        // Tab Switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabName = btn.dataset.tab;
                
                // Update buttons
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.classList.remove('active', 'gradient-purple', 'text-white');
                    b.classList.add('text-gray-600', 'hover:bg-gray-100');
                });
                btn.classList.add('active', 'gradient-purple', 'text-white');
                btn.classList.remove('text-gray-600', 'hover:bg-gray-100');
                
                // Update content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(tabName + '-section').classList.remove('hidden');
                
                // Load data for the tab
                if (tabName === 'hero') loadHeroSlides();
                if (tabName === 'gallery') loadGallerySlides();
                if (tabName === 'bookings') loadBookings();
                if (tabName === 'messages') loadMessages();
                if (tabName === 'business') loadBusinessInfo();
                if (tabName === 'chatbot') loadChatbotConfig();
                if (tabName === 'about') loadAboutSection();
            });
        });

        // Load Dashboard Data
        async function loadDashboardData() {
            try {
                const [hero, gallery, bookings, messages] = await Promise.all([
                    fetch('/api/hero-slides').then(r => r.json()),
                    fetch('/api/gallery-slides').then(r => r.json()),
                    fetch('/api/bookings').then(r => r.json()),
                    fetch('/api/contact-messages').then(r => r.json())
                ]);
                
                // Handle both array and {success, slides/leads} formats
                const heroData = Array.isArray(hero) ? hero : (hero.slides || []);
                const galleryData = Array.isArray(gallery) ? gallery : (gallery.slides || []);
                const bookingsData = Array.isArray(bookings) ? bookings : (bookings.leads || []);
                const messagesData = Array.isArray(messages) ? messages : (messages.messages || []);
                
                document.getElementById('stat-hero').textContent = heroData.length || 0;
                document.getElementById('stat-gallery').textContent = galleryData.length || 0;
                document.getElementById('stat-bookings').textContent = bookingsData.length || 0;
                document.getElementById('stat-messages').textContent = messagesData.length || 0;
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
            }
        }

        // Load Hero Slides
        async function loadHeroSlides() {
            try {
                const response = await fetch('/api/hero-slides');
                const data = await response.json();
                const slides = Array.isArray(data) ? data : (data.slides || []);
                
                const container = document.getElementById('hero-slides-list');
                container.innerHTML = slides.map(slide => `
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <img src="${slide.image}" alt="${slide.title}" class="w-full h-48 object-cover rounded-lg mb-4" onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22%3E%3Crect fill=%22%23667eea%22 width=%22400%22 height=%22300%22/%3E%3Ctext fill=%22white%22 font-size=%2220%22 x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22%3EImage Not Available%3C/text%3E%3C/svg%3E'" loading="lazy">
                        <h3 class="font-bold text-lg mb-2">${slide.title}</h3>
                        <p class="text-gray-600 mb-4">${slide.description || ''}</p>
                        <div class="flex gap-2">
                            <button onclick="editHeroSlide(${slide.id})" class="btn btn-primary flex-1">
                                <i class="fas fa-edit mr-2"></i>Edit
                            </button>
                            <button onclick="deleteHeroSlide(${slide.id})" class="btn btn-danger flex-1">
                                <i class="fas fa-trash mr-2"></i>Delete
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading hero slides:', error);
            }
        }

        // Load Gallery Slides
        async function loadGallerySlides() {
            try {
                const response = await fetch('/api/gallery-slides');
                const data = await response.json();
                const slides = Array.isArray(data) ? data : (data.slides || []);
                
                const container = document.getElementById('gallery-images-list');
                if (!container) {
                    console.error('Gallery container not found');
                    return;
                }
                container.innerHTML = slides.map(slide => `
                    <div class="bg-white rounded-xl overflow-hidden shadow-lg">
                        <img src="${slide.image}" alt="${slide.title}" class="w-full h-48 object-cover" onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22%3E%3Crect fill=%22%2364748b%22 width=%22400%22 height=%22300%22/%3E%3Ctext fill=%22white%22 font-size=%2220%22 x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22%3EImage Not Available%3C/text%3E%3C/svg%3E'" loading="lazy">
                        <div class="p-4">
                            <h4 class="font-semibold mb-2">${slide.title}</h4>
                            <p class="text-sm text-gray-600 mb-3">${slide.description || ''}</p>
                            <div class="flex gap-2">
                                <button onclick="editGallerySlide(${slide.id})" class="btn btn-secondary flex-1">
                                    <i class="fas fa-edit mr-1"></i>Edit
                                </button>
                                <button onclick="deleteGallerySlide(${slide.id})" class="btn btn-danger flex-1">
                                    <i class="fas fa-trash mr-1"></i>Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading gallery slides:', error);
            }
        }

        // Load Bookings
        async function loadBookings() {
            try {
                const response = await fetch('/api/bookings');
                const data = await response.json();
                const bookings = Array.isArray(data) ? data : (data.leads || []);
                
                const container = document.getElementById('bookings-list');
                container.innerHTML = bookings.map(booking => `
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="font-bold text-lg">${booking.name}</h3>
                                <p class="text-gray-600">${booking.phone}</p>
                                <p class="text-gray-600">${booking.email || ''}</p>
                            </div>
                            <span class="px-3 py-1 rounded-full text-sm font-semibold ${booking.status === 'confirmed' ? 'bg-green-100 text-green-600' : 'bg-yellow-100 text-yellow-600'}">
                                ${booking.status}
                            </span>
                        </div>
                        <p class="text-sm text-gray-600 mb-2"><strong>Service:</strong> ${booking.service || 'N/A'}</p>
                        <p class="text-sm text-gray-600 mb-2"><strong>Date:</strong> ${booking.booking_date || 'N/A'}</p>
                        <p class="text-sm text-gray-600 mb-4"><strong>Message:</strong> ${booking.message || 'None'}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 mb-3">
                            <a href="https://wa.me/${booking.phone.replace(/[^0-9]/g, '')}" target="_blank" class="btn btn-success text-center" style="background: #25D366; color: white; padding: 10px; border-radius: 8px; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <i class="fab fa-whatsapp"></i><span>WhatsApp</span>
                            </a>
                            <a href="tel:${booking.phone}" class="btn text-center" style="background: linear-gradient(to right, #7C3AED, #EC4899); color: white; padding: 10px; border-radius: 8px; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <i class="fas fa-phone"></i><span>Call</span>
                            </a>
                            ${booking.email ? `<a href="mailto:${booking.email}" class="btn text-center" style="background: linear-gradient(to right, #10B981, #3B82F6); color: white; padding: 10px; border-radius: 8px; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <i class="fas fa-envelope"></i><span>Email</span>
                            </a>` : ''}
                        </div>
                        <button onclick="deleteBooking(${booking.id})" class="btn btn-danger w-full">
                            <i class="fas fa-trash mr-2"></i>Delete
                        </button>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading bookings:', error);
            }
        }

        // Load Messages
        async function loadMessages() {
            try {
                const response = await fetch('/api/contact-messages');
                const data = await response.json();
                const messages = Array.isArray(data) ? data : (data.messages || []);
                
                const container = document.getElementById('messages-list');
                container.innerHTML = messages.map(msg => `
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="font-bold text-lg">${msg.name}</h3>
                                <p class="text-gray-600">${msg.email}</p>
                                <p class="text-gray-600">${msg.phone || ''}</p>
                            </div>
                            <span class="text-xs text-gray-500">${new Date(msg.created_at).toLocaleDateString()}</span>
                        </div>
                        <p class="text-sm text-gray-600 mb-2"><strong>Subject:</strong> ${msg.subject || 'N/A'}</p>
                        <p class="text-sm text-gray-600 mb-4">${msg.message}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 mb-3">
                            ${msg.phone ? `<a href="https://wa.me/${msg.phone.replace(/[^0-9]/g, '')}" target="_blank" class="btn text-center" style="background: #25D366; color: white; padding: 10px; border-radius: 8px; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <i class="fab fa-whatsapp"></i><span>WhatsApp</span>
                            </a>
                            <a href="tel:${msg.phone}" class="btn text-center" style="background: linear-gradient(to right, #7C3AED, #EC4899); color: white; padding: 10px; border-radius: 8px; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <i class="fas fa-phone"></i><span>Call</span>
                            </a>` : ''}
                            <a href="mailto:${msg.email}" class="btn text-center" style="background: linear-gradient(to right, #10B981, #3B82F6); color: white; padding: 10px; border-radius: 8px; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <i class="fas fa-envelope"></i><span>Email</span>
                            </a>
                        </div>
                        <button onclick="deleteMessage(${msg.id})" class="btn btn-danger w-full">
                            <i class="fas fa-trash mr-2"></i>Delete
                        </button>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading messages:', error);
            }
        }

        // Load Business Info
        async function loadBusinessInfo() {
            try {
                const response = await fetch('/api/business-info', {
                    cache: 'no-cache'  // Prevent caching to always get fresh data
                });
                if (!response.ok) {
                    console.error('Failed to load business info');
                    return;
                }
                const info = await response.json();
                
                if (info && Object.keys(info).length > 0) {
                    // Map database fields to form fields
                    if (document.getElementById('business-address')) {
                        document.getElementById('business-address').value = info.address || '';
                    }
                    if (document.getElementById('business-email')) {
                        document.getElementById('business-email').value = info.email || '';
                    }
                    if (document.getElementById('business-phone')) {
                        document.getElementById('business-phone').value = info.phone || '';
                    }
                    if (document.getElementById('business-website')) {
                        document.getElementById('business-website').value = info.website || '';
                    }
                    if (document.getElementById('business-hours-weekday')) {
                        document.getElementById('business-hours-weekday').value = info.hours_weekday || '';
                    }
                    if (document.getElementById('business-hours-sunday')) {
                        document.getElementById('business-hours-sunday').value = info.hours_sunday || '';
                    }
                    if (document.getElementById('facebook-url')) {
                        document.getElementById('facebook-url').value = info.facebook || '';
                    }
                    if (document.getElementById('instagram-url')) {
                        document.getElementById('instagram-url').value = info.instagram || '';
                    }
                    if (document.getElementById('youtube-url')) {
                        document.getElementById('youtube-url').value = info.youtube || '';
                    }
                    if (document.getElementById('twitter-url')) {
                        document.getElementById('twitter-url').value = info.twitter || '';
                    }
                }
            } catch (error) {
                console.error('Error loading business info:', error);
            }
        }

        // Delete Functions
        async function deleteHeroSlide(id) {
            if (!confirm('Delete this hero slide?')) return;
            try {
                await fetch(`/api/hero-slides/${id}`, { method: 'DELETE' });
                loadHeroSlides();
                loadDashboardData();
            } catch (error) {
                console.error('Error deleting hero slide:', error);
                alert('Error deleting slide');
            }
        }

        async function editGallerySlide(id) {
            try {
                const response = await fetch(`/api/gallery-slides/${id}`);
                const slide = await response.json();
                
                // Show form
                document.getElementById('gallery-image-form-container').classList.remove('hidden');
                
                // Populate form fields
                document.getElementById('gallery-image-id').value = id;
                document.getElementById('gallery-image-title').value = slide.title || '';
                document.getElementById('gallery-image-description').value = slide.description || '';
                
                // Change button to update mode
                const submitBtn = document.querySelector('#gallery-image-form button[type="submit"]');
                submitBtn.textContent = 'Update Image';
                
                // Scroll to form
                document.getElementById('gallery-image-form-container').scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error('Error loading gallery slide:', error);
                alert('Error loading image data');
            }
        }

        // Handle gallery form submission
        document.getElementById('gallery-image-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const id = document.getElementById('gallery-image-id').value;
            const title = document.getElementById('gallery-image-title').value;
            const description = document.getElementById('gallery-image-description').value;
            const fileInput = document.getElementById('gallery-image-file');
            
            let imageUrl = '';
            
            // Upload image if file selected
            if (fileInput.files.length > 0) {
                const formData = new FormData();
                formData.append('file', fileInput.files[0]);
                formData.append('folder', 'gallery');  // Specify gallery folder
                
                try {
                    const uploadResponse = await fetch('/api/upload', {
                        method: 'POST',
                        body: formData
                    });
                    const uploadData = await uploadResponse.json();
                    imageUrl = uploadData.url;
                } catch (error) {
                    console.error('Error uploading image:', error);
                    alert('Error uploading image');
                    return;
                }
            }
            
            const data = {
                title: title,
                description: description
            };
            
            if (imageUrl) {
                data.image = imageUrl;
            }
            
            try {
                if (id) {
                    // Update existing
                    await fetch(`/api/gallery-slides/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    alert('Image updated successfully!');
                } else {
                    // Create new
                    if (!imageUrl) {
                        alert('Please select an image file');
                        return;
                    }
                    data.image = imageUrl;
                    await fetch('/api/gallery-slides', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    alert('Image added successfully!');
                }
                
                // Reset form
                document.getElementById('gallery-image-form').reset();
                document.getElementById('gallery-image-id').value = '';
                document.getElementById('gallery-image-form-container').classList.add('hidden');
                const submitBtn = document.querySelector('#gallery-image-form button[type="submit"]');
                submitBtn.textContent = 'Save Image';
                
                loadGallerySlides();
                loadDashboardData();
            } catch (error) {
                console.error('Error saving gallery image:', error);
                alert('Error saving image');
            }
        });
        
        // Show gallery add form
        document.getElementById('add-gallery-image-btn').addEventListener('click', () => {
            document.getElementById('gallery-image-form').reset();
            document.getElementById('gallery-image-id').value = '';
            document.getElementById('gallery-image-form-container').classList.remove('hidden');
            document.querySelector('#gallery-image-form button[type="submit"]').textContent = 'Save Image';
            document.getElementById('gallery-image-form-container').scrollIntoView({ behavior: 'smooth' });
        });
        
        // Cancel gallery edit
        document.getElementById('cancel-gallery-image-edit').addEventListener('click', () => {
            document.getElementById('gallery-image-form').reset();
            document.getElementById('gallery-image-id').value = '';
            document.getElementById('gallery-image-form-container').classList.add('hidden');
        });

        async function editHeroSlide(id) {
            try {
                const response = await fetch(`/api/hero-slides/${id}`);
                const slide = await response.json();
                
                // Show form container
                document.getElementById('hero-slide-form-container').classList.remove('hidden');
                
                // Populate form fields with correct IDs
                document.getElementById('hero-slide-id').value = id;
                document.getElementById('hero-slide-title').value = slide.title || '';
                document.getElementById('hero-slide-description').value = slide.description || '';
                
                // Scroll to form
                document.getElementById('hero-slide-form-container').scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error('Error loading hero slide:', error);
                alert('Error loading slide data');
            }
        }

        // Hero slide form submission handler
        document.getElementById('hero-slide-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const id = document.getElementById('hero-slide-id').value;
            const title = document.getElementById('hero-slide-title').value;
            const description = document.getElementById('hero-slide-description').value;
            const fileInput = document.getElementById('hero-slide-image');
            
            try {
                let mediaUrl = '';
                
                // Upload file if selected
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('folder', 'hero-slides');
                    
                    const uploadResponse = await fetch('/api/upload', {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!uploadResponse.ok) {
                        const errorData = await uploadResponse.json();
                        throw new Error(errorData.error || 'Failed to upload file');
                    }
                    
                    const uploadData = await uploadResponse.json();
                    mediaUrl = uploadData.url;
                }
                
                const data = {
                    title: title,
                    description: description
                };
                
                // Add image URL if media was uploaded
                if (mediaUrl) {
                    data.image = mediaUrl;
                }
                
                if (id) {
                    // Update existing slide
                    const updateResponse = await fetch(`/api/hero-slides/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    
                    if (!updateResponse.ok) {
                        throw new Error('Failed to update slide');
                    }
                    
                    alert('Hero slide updated successfully!');
                } else {
                    // Create new slide
                    if (!mediaUrl) {
                        alert('Please select an image or video for the new slide');
                        return;
                    }
                    
                    await fetch('/api/hero-slides', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    alert('Hero slide created successfully!');
                }
                
                // Reset form and hide container
                document.getElementById('hero-slide-form').reset();
                document.getElementById('hero-slide-id').value = '';
                document.getElementById('hero-slide-form-container').classList.add('hidden');
                
                // Reload slides
                loadHeroSlides();
            } catch (error) {
                console.error('Error saving hero slide:', error);
                let errorMsg = 'Error saving hero slide: ' + error.message;
                if (error.message.includes('fetch')) {
                    errorMsg = 'Network error. Please check your internet connection and try again.';
                }
                alert(errorMsg);
            }
        });
        
        // Add hero slide button handler
        document.getElementById('add-hero-slide-btn').addEventListener('click', () => {
            document.getElementById('hero-slide-form').reset();
            document.getElementById('hero-slide-id').value = '';
            document.getElementById('hero-slide-form-container').classList.remove('hidden');
            document.getElementById('hero-slide-form-container').scrollIntoView({ behavior: 'smooth' });
        });
        
        // Cancel hero slide edit button handler
        document.getElementById('cancel-hero-slide-edit').addEventListener('click', () => {
            document.getElementById('hero-slide-form').reset();
            document.getElementById('hero-slide-id').value = '';
            document.getElementById('hero-slide-form-container').classList.add('hidden');
        });
        
        async function updateHeroSlide(id) {
            // This function is no longer used - kept for backward compatibility
            const data = {
                image: document.getElementById('hero-slide-image').value,
                title: document.getElementById('hero-slide-title').value,
                description: document.getElementById('hero-slide-description').value
            };

            try {
                await fetch(`/api/hero-slides/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                // Reset form
                document.getElementById('hero-slide-form').reset();
                
                loadHeroSlides();
                alert('Slide updated successfully!');
            } catch (error) {
                console.error('Error updating hero slide:', error);
                alert('Error updating slide');
            }
        }

        // Business edit mode toggle
        document.getElementById('edit-business-btn').addEventListener('click', function() {
            const inputs = document.querySelectorAll('#business-info-form input, #business-info-form textarea');
            inputs.forEach(input => input.removeAttribute('readonly'));
            document.getElementById('edit-business-btn').classList.add('hidden');
            document.getElementById('save-business-btn').classList.remove('hidden');
            document.getElementById('cancel-business-btn').classList.remove('hidden');
        });
        
        document.getElementById('cancel-business-btn').addEventListener('click', function() {
            const inputs = document.querySelectorAll('#business-info-form input, #business-info-form textarea');
            inputs.forEach(input => input.setAttribute('readonly', 'readonly'));
            document.getElementById('edit-business-btn').classList.remove('hidden');
            document.getElementById('save-business-btn').classList.add('hidden');
            document.getElementById('cancel-business-btn').classList.add('hidden');
            loadBusinessInfo(); // Reload original data
        });
        
        // Business info form submission handler
        document.getElementById('business-info-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const businessData = {
                address: document.getElementById('business-address').value,
                email: document.getElementById('business-email').value,
                phone: document.getElementById('business-phone').value,
                website: document.getElementById('business-website').value || '',
                hours_weekday: document.getElementById('business-hours-weekday').value,
                hours_sunday: document.getElementById('business-hours-sunday').value,
                facebook: document.getElementById('facebook-url').value || '',
                instagram: document.getElementById('instagram-url').value || '',
                youtube: document.getElementById('youtube-url').value || '',
                twitter: document.getElementById('twitter-url').value || ''
            };
            
            try {
                const response = await fetch('/api/business-info', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(businessData)
                });
                
                if (!response.ok) {
                    throw new Error('Failed to save business information');
                }
                
                alert('Business information saved successfully!');
                
                // Set form back to readonly mode
                const inputs = document.querySelectorAll('#business-info-form input, #business-info-form textarea');
                inputs.forEach(input => input.setAttribute('readonly', 'readonly'));
                document.getElementById('edit-business-btn').classList.remove('hidden');
                document.getElementById('save-business-btn').classList.add('hidden');
                document.getElementById('cancel-business-btn').classList.add('hidden');
                
                // Reload business info to show updated data
                await loadBusinessInfo();
                
            } catch (error) {
                console.error('Error saving business information:', error);
                alert('Error saving business information: ' + error.message);
            }
        });
        
        // Initialize business form as readonly
        function initializeBusinessForm() {
            const inputs = document.querySelectorAll('#business-info-form input, #business-info-form textarea');
            inputs.forEach(input => input.setAttribute('readonly', 'readonly'));
        }
        
        // Chatbot config edit mode toggle
        function toggleChatbotEdit() {
            const inputs = document.querySelectorAll('#chatbot-config-form input, #chatbot-config-form textarea');
            const editBtn = document.getElementById('edit-chatbot-btn');
            const actionsDiv = document.getElementById('chatbot-form-actions');
            
            inputs.forEach(input => input.removeAttribute('readonly'));
            editBtn.style.display = 'none';
            actionsDiv.style.display = 'flex';
        }
        
        function cancelChatbotEdit() {
            const inputs = document.querySelectorAll('#chatbot-config-form input, #chatbot-config-form textarea');
            const editBtn = document.getElementById('edit-chatbot-btn');
            const actionsDiv = document.getElementById('chatbot-form-actions');
            
            inputs.forEach(input => input.setAttribute('readonly', 'readonly'));
            editBtn.style.display = 'inline-block';
            actionsDiv.style.display = 'none';
            // Reload original data
            loadChatbotConfig();
        }
        
        // Chatbot config form submission handler
        document.getElementById('chatbot-config-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const chatbotData = {
                google_maps_url: document.getElementById('chatbot-google-maps').value || '',
                google_review_url: document.getElementById('chatbot-google-review').value || '',
                services: document.getElementById('chatbot-services').value || '',
                facebook: document.getElementById('chatbot-facebook').value || '',
                instagram: document.getElementById('chatbot-instagram').value || '',
                twitter: document.getElementById('chatbot-twitter').value || '',
                youtube: document.getElementById('chatbot-youtube').value || '',
                linkedin: document.getElementById('chatbot-linkedin').value || '',
                hours_weekday: document.getElementById('chatbot-hours-weekday').value || '',
                hours_sunday: document.getElementById('chatbot-hours-sunday').value || ''
            };
            
            try {
                const response = await fetch('/api/chatbot-config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(chatbotData)
                });
                
                if (!response.ok) {
                    throw new Error('Failed to save chatbot configuration');
                }
                
                alert('Chatbot configuration saved successfully!');
                
                // Set form back to readonly mode
                const inputs = document.querySelectorAll('#chatbot-config-form input, #chatbot-config-form textarea');
                const editBtn = document.getElementById('edit-chatbot-btn');
                const actionsDiv = document.getElementById('chatbot-form-actions');
                
                inputs.forEach(input => input.setAttribute('readonly', 'readonly'));
                editBtn.style.display = 'inline-block';
                actionsDiv.style.display = 'none';
                
                // Reload chatbot config to show updated data
                await loadChatbotConfig();
                
            } catch (error) {
                console.error('Error saving chatbot configuration:', error);
                alert('Error saving chatbot configuration: ' + error.message);
            }
        });
        
        // Initialize chatbot form as readonly
        function initializeChatbotForm() {
            const inputs = document.querySelectorAll('#chatbot-config-form input, #chatbot-config-form textarea');
            inputs.forEach(input => input.setAttribute('readonly', 'readonly'));
        }
        
        // Load chatbot config (placeholder)
        async function loadChatbotConfig() {
            try {
                const response = await fetch('/api/chatbot-config', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' },
                    cache: 'no-cache'  // Prevent caching to always get fresh data
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load chatbot configuration');
                }
                
                const data = await response.json();
                
                // Populate form fields with fetched data
                document.getElementById('chatbot-google-maps').value = data.google_maps_url || '';
                document.getElementById('chatbot-google-review').value = data.google_review_url || '';
                document.getElementById('chatbot-services').value = data.services || '';
                document.getElementById('chatbot-facebook').value = data.facebook || '';
                document.getElementById('chatbot-instagram').value = data.instagram || '';
                document.getElementById('chatbot-twitter').value = data.twitter || '';
                document.getElementById('chatbot-youtube').value = data.youtube || '';
                document.getElementById('chatbot-linkedin').value = data.linkedin || '';
                document.getElementById('chatbot-hours-weekday').value = data.hours_weekday || '';
                document.getElementById('chatbot-hours-sunday').value = data.hours_sunday || '';
            } catch (error) {
                console.error('Error loading chatbot config:', error);
            }
        }

        async function deleteGallerySlide(id) {
            if (!confirm('Delete this gallery image?')) return;
            try {
                await fetch(`/api/gallery-slides/${id}`, { method: 'DELETE' });
                loadGallerySlides();
                loadDashboardData();
            } catch (error) {
                console.error('Error deleting gallery slide:', error);
                alert('Error deleting image');
            }
        }

        async function deleteBooking(id) {
            if (!confirm('Delete this booking?')) return;
            try {
                await fetch(`/api/bookings/${id}`, { method: 'DELETE' });
                loadBookings();
                loadDashboardData();
            } catch (error) {
                console.error('Error deleting booking:', error);
                alert('Error deleting booking');
            }
        }

        async function deleteMessage(id) {
            if (!confirm('Delete this message?')) return;
            try {
                await fetch(`/api/contact-messages/${id}`, { method: 'DELETE' });
                loadMessages();
                loadDashboardData();
            } catch (error) {
                console.error('Error deleting message:', error);
                alert('Error deleting message');
            }
        }

        // About Section Functions
        async function loadAboutSection() {
            try {
                const response = await fetch('/api/about-section', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' },
                    cache: 'no-cache'
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load about section');
                }
                
                const data = await response.json();
                
                if (data && Object.keys(data).length > 0) {
                    document.getElementById('about-title').value = data.title || '';
                    document.getElementById('about-description').value = data.description || '';
                    document.getElementById('about-experience').value = data.experience || '';
                    document.getElementById('about-specialization').value = data.specialization || '';
                    document.getElementById('about-credentials').value = data.credentials || '';
                    document.getElementById('about-image-url').value = data.image || '';
                    
                    // Show image preview if URL exists
                    if (data.image) {
                        document.getElementById('about-image-preview').innerHTML = `
                            <img src="${data.image}" alt="Astrologer" class="w-48 h-48 object-cover rounded-lg shadow-lg">
                        `;
                    }
                }
            } catch (error) {
                console.error('Error loading about section:', error);
            }
        }

        function enableAboutEdit() {
            const inputs = document.querySelectorAll('#about-form input:not([type=file]), #about-form textarea');
            const editBtn = document.getElementById('edit-about-btn');
            const actionsDiv = document.getElementById('about-form-actions');
            const uploadBtn = document.getElementById('about-upload-btn');
            const fileInput = document.getElementById('about-image-file');
            
            inputs.forEach(input => input.removeAttribute('readonly'));
            fileInput.removeAttribute('disabled');
            uploadBtn.removeAttribute('disabled');
            editBtn.style.display = 'none';
            actionsDiv.style.display = 'flex';
        }

        function cancelAboutEdit() {
            const inputs = document.querySelectorAll('#about-form input:not([type=file]), #about-form textarea');
            const editBtn = document.getElementById('edit-about-btn');
            const actionsDiv = document.getElementById('about-form-actions');
            const uploadBtn = document.getElementById('about-upload-btn');
            const fileInput = document.getElementById('about-image-file');
            
            inputs.forEach(input => input.setAttribute('readonly', 'readonly'));
            fileInput.setAttribute('disabled', 'disabled');
            uploadBtn.setAttribute('disabled', 'disabled');
            editBtn.style.display = 'inline-block';
            actionsDiv.style.display = 'none';
            
            loadAboutSection(); // Reload original data
        }

        async function uploadAboutImage() {
            const fileInput = document.getElementById('about-image-file');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select an image file');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            formData.append('folder', 'about');
            
            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success && result.url) {
                    document.getElementById('about-image-url').value = result.url;
                    document.getElementById('about-image-preview').innerHTML = `
                        <img src="${result.url}" alt="Astrologer" class="w-48 h-48 object-cover rounded-lg shadow-lg" onload="console.log('Image loaded successfully')" onerror="console.error('Image load failed'); this.style.display='none';">
                    `;
                    alert('Image uploaded successfully!');
                } else {
                    alert('Error uploading image: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error uploading image:', error);
                alert('Error uploading image');
            }
        }

        document.getElementById('about-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const aboutData = {
                title: document.getElementById('about-title').value || '',
                description: document.getElementById('about-description').value || '',
                experience: document.getElementById('about-experience').value || '',
                specialization: document.getElementById('about-specialization').value || '',
                credentials: document.getElementById('about-credentials').value || '',
                image: document.getElementById('about-image-url').value || ''
            };
            
            try {
                const response = await fetch('/api/about-section', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(aboutData)
                });
                
                if (!response.ok) {
                    throw new Error('Failed to save about section');
                }
                
                alert('About section saved successfully!');
                
                // Set form back to readonly mode
                const inputs = document.querySelectorAll('#about-form input:not([type=file]), #about-form textarea');
                const editBtn = document.getElementById('edit-about-btn');
                const actionsDiv = document.getElementById('about-form-actions');
                const uploadBtn = document.getElementById('about-upload-btn');
                const fileInput = document.getElementById('about-image-file');
                
                inputs.forEach(input => input.setAttribute('readonly', 'readonly'));
                fileInput.setAttribute('disabled', 'disabled');
                uploadBtn.setAttribute('disabled', 'disabled');
                editBtn.style.display = 'inline-block';
                actionsDiv.style.display = 'none';
                
                // Reload about section to show updated data
                await loadAboutSection();
                
            } catch (error) {
                console.error('Error saving about section:', error);
                alert('Error saving about section: ' + error.message);
            }
        });
    </script>
</body>
</html>